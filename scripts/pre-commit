#!/bin/bash
set -e

source "$HOME/.cargo/env" 2>/dev/null || true

REPO_ROOT="$(git rev-parse --show-toplevel)"
CRATES="tensor_store relational_engine"

echo "Running pre-commit checks..."

for crate in $CRATES; do
    echo ""
    echo "=== Checking $crate ==="
    cd "$REPO_ROOT/$crate"

    echo "Formatting..."
    cargo fmt --check

    echo "Clippy..."
    cargo clippy -- -D warnings

    echo "Testing..."
    cargo test --quiet

    echo "Docs..."
    cargo doc --no-deps --quiet
done

echo ""
echo "All checks passed."
